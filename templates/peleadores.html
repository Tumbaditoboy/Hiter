<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Peleadores</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    
    <style>
      
      .fighter-card {
          background-color: #d67c7f; 
          border-radius: 12px;
          color: #000;
          box-shadow: 0 4px 6px rgba(0,0,0,0.3);
          transition: transform 0.2s;
          height: 100%;
          position: relative;
          overflow: hidden;
      }

      .fighter-card:hover {
          transform: translateY(-5px);
      }

      .fighter-header {
          display: flex;
          align-items: center;
          padding: 15px;
      }

      .avatar-container {
          width: 80px;
          height: 80px;
          background-color: white;
          border-radius: 50%;
          display: flex;
          justify-content: center;
          align-items: center;
          overflow: hidden;
          margin-right: 15px;
          flex-shrink: 0;
      }

      .avatar-img {
          width: 100%;
          height: 100%;
          object-fit: cover;
      }

      /* Si no hay foto, usamos un icono genérico nimodo */
      .avatar-placeholder {
          font-size: 40px;
          color: #d67c7f;
      }

      .fighter-info {
          flex-grow: 1;
          line-height: 1.2;
      }

      /* Estilo para "STRIKER" */
      .fighter-alias {
          color: white;
          font-weight: 900;
          font-size: 1.4rem;
          text-transform: uppercase;
          margin: 0;
          font-family: sans-serif;
      }

      /* Estilo para el nombre */
      .fighter-name {
          color: black;
          font-weight: 900;
          font-size: 1.1rem;
          text-transform: uppercase;
          margin: 0;
      }

      /* Estilo para Nivel y detalles */
      .fighter-meta {
          color: black;
          font-weight: bold;
          font-size: 0.9rem;
          margin-top: 2px;
      }

      .fighter-body {
          padding: 0 15px 15px 15px;
          font-size: 0.9rem;
          color: #222;
      }

      /* Botones de acción flotantes */
      .card-actions {
          position: absolute;
          top: 10px;
          right: 10px;
          background: rgba(255,255,255,0.8);
          border-radius: 20px;
          padding: 2px 8px;
          z-index: 10;
      }

      .btn-icon {
          border: none;
          background: transparent;
          color: #333;
          padding: 0 5px;
          transition: all 0.2s;
      }

      .btn-icon:hover {
          color: #000;
          transform: scale(1.1);
      }

      .btn-icon.delete:hover {
          color: #dc3545;
      }
    </style>
  </head>
  <body class="p-4 bg-dark">
    <div class="container">
      <div class="d-flex justify-content-between align-items-center mb-4 text-white">
        <h1 class="h3">Peleadores</h1>
        <button class="btn btn-warning fw-bold" onclick="openAddModal()">
          <i class="bi bi-plus-lg"></i> Agregar Peleador
        </button>
      </div>

      <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
        
        {% for p in peleadores %}
        <div class="col">
          <div class="fighter-card fighter-item" 
               data-id="{{ p.id }}"
               data-nombre="{{ p.nombre|e }}"
               data-alias="{{ p.alias|e }}"
               data-edad="{{ p.edad }}"
               data-ubicacion="{{ p.ubicacion|e }}"
               data-nivel_pelea="{{ p.nivel_pelea }}"
               data-foto="{{ p.foto|e }}"
               data-descripcion="{{ p.descripcion|e }}">
            
            <div class="card-actions">
              <button class="btn-icon" onclick="openEditModal('{{ p.id|e }}')" title="Editar">
                <i class="bi bi-pencil-fill"></i>
              </button>
              <button class="btn-icon delete" onclick="deletePeleador('{{ p.id|e }}')" title="Eliminar">
                <i class="bi bi-trash-fill"></i>
              </button>
            </div>

            <div class="fighter-header">
              <div class="avatar-container">
                {% if p.foto %}
                  <img src="{{ p.foto }}" alt="foto" class="avatar-img">
                {% else %}
                  <i class="bi bi-person-fill avatar-placeholder"></i>
                {% endif %}
              </div>
              <div class="fighter-info">
                <h2 class="fighter-alias">{{ p.alias }}</h2>
                <h3 class="fighter-name">{{ p.nombre }}</h3>
                <div class="fighter-meta">
                  Nivel {{ p.nivel_pelea }} <br>
                  <small class="fw-normal">{{ p.ubicacion }}</small>
                </div>
              </div>
            </div>

            <div class="fighter-body">
              <p class="m-0 text-break">
                {{ p.descripcion }}
              </p>
              <small class="text-white-50 mt-2 d-block">ID: {{ p.id }} | Edad: {{ p.edad }}</small>
            </div>
          </div>
        </div>
        {% else %}
        <div class="col-12 text-center text-white">
          <p>No hay peleadores registrados</p>
        </div>
        {% endfor %}

      </div>
    </div>

    <div class="modal fade" id="peleadorModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <form id="peleadorForm" onsubmit="event.preventDefault(); savePeleador();">
            <div class="modal-header bg-dark text-white">
              <h5 class="modal-title" id="modalTitle">Agregar Peleador</h5>
              <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Cerrar"></button>
            </div>
            <div class="modal-body">
              <input type="hidden" id="peleadorId" />
              <div class="row g-2">
                <div class="col-md-6">
                  <label class="form-label">Nombre</label>
                  <input class="form-control" id="nombre" required />
                </div>
                <div class="col-md-6">
                  <label class="form-label">Alias</label>
                  <input class="form-control" id="alias" required />
                </div>
                <div class="col-md-3">
                  <label class="form-label">Edad</label>
                  <input type="number" class="form-control" id="edad" required />
                </div>
                <div class="col-md-9">
                  <label class="form-label">Ubicación</label>
                  <input class="form-control" id="ubicacion" required />
                </div>
                <div class="col-md-4">
                  <label class="form-label">Nivel pelea</label>
                  <input type="number" class="form-control" id="nivel_pelea" required />
                </div>
                <div class="col-md-8">
                  <label class="form-label">Foto (URL)</label>
                  <input class="form-control" id="foto" placeholder="https://..." />
                </div>
                <div class="col-12">
                  <label class="form-label">Descripción</label>
                  <textarea class="form-control" id="descripcion" rows="3"></textarea>
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
              <button type="submit" class="btn btn-primary">Guardar</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      const modalEl = document.getElementById('peleadorModal');
      const modal = new bootstrap.Modal(modalEl);

      function openAddModal() {
        document.getElementById('modalTitle').textContent = 'Agregar Peleador';
        clearForm();
        modal.show();
      }

      function openEditModal(id) {
        // Busca el elemento div con la clase .fighter-item
        const item = document.querySelector(`.fighter-item[data-id="${id}"]`);
        
        if (!item) return alert('Registro no encontrado');
        
        document.getElementById('modalTitle').textContent = 'Editar Peleador';
        document.getElementById('peleadorId').value = id;
        document.getElementById('nombre').value = item.dataset.nombre || '';
        document.getElementById('alias').value = item.dataset.alias || '';
        document.getElementById('edad').value = item.dataset.edad || '';
        document.getElementById('ubicacion').value = item.dataset.ubicacion || '';
        document.getElementById('nivel_pelea').value = item.dataset.nivel_pelea || '';
        document.getElementById('foto').value = item.dataset.foto || '';
        document.getElementById('descripcion').value = item.dataset.descripcion || '';
        
        modal.show();
      }

      function clearForm() {
        document.getElementById('peleadorId').value = '';
        document.getElementById('nombre').value = '';
        document.getElementById('alias').value = '';
        document.getElementById('edad').value = '';
        document.getElementById('ubicacion').value = '';
        document.getElementById('nivel_pelea').value = '';
        document.getElementById('foto').value = '';
        document.getElementById('descripcion').value = '';
      }

      // Funciones Placeholder para la interacción con el backend (POST, PUT)
      async function savePeleador() {
        const id = document.getElementById('peleadorId').value;
        const payload = {
          nombre: document.getElementById('nombre').value,
          alias: document.getElementById('alias').value,
          edad: parseInt(document.getElementById('edad').value) || 0,
          ubicacion: document.getElementById('ubicacion').value,
          nivel_pelea: parseInt(document.getElementById('nivel_pelea').value) || 0,
          foto: document.getElementById('foto').value,
          descripcion: document.getElementById('descripcion').value
        };

        try {
          // *** ESTE CÓDIGO REQUIERE QUE TENGAS UN SERVIDOR BACKEND (Flask, Django, etc.)
          // *** QUE RESPONDA A LAS RUTAS /peleadores y /peleadores/{id}
          let res;
          if (id) {
            res = await fetch(`/peleadores/${id}`, {
              method: 'PUT',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(payload)
            });
          } else {
            res = await fetch('/peleadores', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(payload)
            });
          }

          const body = await res.json();
          const success = body.success === undefined ? (body === true || body === 1) : body.success;
          
          if (success) {
            location.reload();
          } else {
            alert('Operación fallida');
          }
        } catch (err) {
          console.error(err);
          alert('Error de red o Servidor no responde');
        }
      }

      async function deletePeleador(id) {
        if (!confirm('¿Seguro que desea eliminar este peleador?')) return;
        try {
          const res = await fetch(`/peleadores/${id}`, { method: 'DELETE' });
          const body = await res.json();
          if (body.success) {
            location.reload();
          } else {
            alert('No se pudo eliminar');
          }
        } catch (err) {
          console.error(err);
          alert('Error de red o Servidor no responde');
        }
      }
    </script>
  </body>
</html>