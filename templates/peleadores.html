<!-- ...existing code... -->
<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Peleadores</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
      img.thumb { width: 60px; height: auto; object-fit: cover; }
    </style>
  </head>
  <body class="p-4">
    <div class="container">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h1 class="h3">Peleadores</h1>
        <button class="btn btn-primary" onclick="openAddModal()">Agregar Peleador</button>
      </div>

      <table class="table table-striped table-bordered">
        <thead class="table-dark">
          <tr>
            <th>ID</th>
            <th>Nombre</th>
            <th>Alias</th>
            <th>Edad</th>
            <th>Ubicación</th>
            <th>Nivel</th>
            <th>Foto</th>
            <th>Descripción</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          {% for p in peleadores %}
          <tr data-id="{{ p.id }}"
              data-nombre="{{ p.nombre|e }}"
              data-alias="{{ p.alias|e }}"
              data-edad="{{ p.edad }}"
              data-ubicacion="{{ p.ubicacion|e }}"
              data-nivel_pelea="{{ p.nivel_pelea }}"
              data-foto="{{ p.foto|e }}"
              data-descripcion="{{ p.descripcion|e }}">
            <td>{{ p.id }}</td>
            <td>{{ p.nombre }}</td>
            <td>{{ p.alias }}</td>
            <td>{{ p.edad }}</td>
            <td>{{ p.ubicacion }}</td>
            <td>{{ p.nivel_pelea }}</td>
            <td><img src="{{ p.foto }}" alt="foto" class="thumb"></td>
            <td>{{ p.descripcion }}</td>
<td>
  <button class="btn btn-sm btn-secondary" onclick="openEditModal('{{ p.id|e }}')">Editar</button>
  <button class="btn btn-sm btn-danger" onclick="deletePeleador('{{ p.id|e }}')">Eliminar</button>
</td>
          </tr>
          {% else %}
          <tr><td colspan="9" class="text-center">No hay peleadores</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="peleadorModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <form id="peleadorForm" onsubmit="event.preventDefault(); savePeleador();">
            <div class="modal-header">
              <h5 class="modal-title" id="modalTitle">Agregar Peleador</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
            </div>
            <div class="modal-body">
              <input type="hidden" id="peleadorId" />
              <div class="row g-2">
                <div class="col-md-6">
                  <label class="form-label">Nombre</label>
                  <input class="form-control" id="nombre" required />
                </div>
                <div class="col-md-6">
                  <label class="form-label">Alias</label>
                  <input class="form-control" id="alias" required />
                </div>
                <div class="col-md-3">
                  <label class="form-label">Edad</label>
                  <input type="number" class="form-control" id="edad" required />
                </div>
                <div class="col-md-9">
                  <label class="form-label">Ubicación</label>
                  <input class="form-control" id="ubicacion" required />
                </div>
                <div class="col-md-4">
                  <label class="form-label">Nivel pelea</label>
                  <input type="number" class="form-control" id="nivel_pelea" required />
                </div>
                <div class="col-md-8">
                  <label class="form-label">Foto (URL)</label>
                  <input class="form-control" id="foto" />
                </div>
                <div class="col-12">
                  <label class="form-label">Descripción</label>
                  <textarea class="form-control" id="descripcion" rows="3"></textarea>
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
              <button type="submit" class="btn btn-primary">Guardar</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      const modalEl = document.getElementById('peleadorModal');
      const modal = new bootstrap.Modal(modalEl);

      function openAddModal() {
        document.getElementById('modalTitle').textContent = 'Agregar Peleador';
        clearForm();
        modal.show();
      }

      function openEditModal(id) {
        const row = document.querySelector(`tr[data-id="${id}"]`);
        if (!row) return alert('Registro no encontrado');
        document.getElementById('modalTitle').textContent = 'Editar Peleador';
        document.getElementById('peleadorId').value = id;
        document.getElementById('nombre').value = row.dataset.nombre || '';
        document.getElementById('alias').value = row.dataset.alias || '';
        document.getElementById('edad').value = row.dataset.edad || '';
        document.getElementById('ubicacion').value = row.dataset.ubicacion || '';
        document.getElementById('nivel_pelea').value = row.dataset.nivel_pelea || '';
        document.getElementById('foto').value = row.dataset.foto || '';
        document.getElementById('descripcion').value = row.dataset.descripcion || '';
        modal.show();
      }

      function clearForm() {
        document.getElementById('peleadorId').value = '';
        document.getElementById('nombre').value = '';
        document.getElementById('alias').value = '';
        document.getElementById('edad').value = '';
        document.getElementById('ubicacion').value = '';
        document.getElementById('nivel_pelea').value = '';
        document.getElementById('foto').value = '';
        document.getElementById('descripcion').value = '';
      }

      async function savePeleador() {
        const id = document.getElementById('peleadorId').value;
        const payload = {
          nombre: document.getElementById('nombre').value,
          alias: document.getElementById('alias').value,
          edad: parseInt(document.getElementById('edad').value) || 0,
          ubicacion: document.getElementById('ubicacion').value,
          nivel_pelea: parseInt(document.getElementById('nivel_pelea').value) || 0,
          foto: document.getElementById('foto').value,
          descripcion: document.getElementById('descripcion').value
        };

        try {
          let res;
          if (id) {
            res = await fetch(`/peleadores/${id}`, {
              method: 'PUT',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(payload)
            });
          } else {
            res = await fetch('/peleadores', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(payload)
            });
          }

          const body = await res.json();
          const success = body.success === undefined ? body === true || body === 1 : body.success;
          if (success) {
            location.reload();
          } else {
            alert('Operación fallida');
          }
        } catch (err) {
          console.error(err);
          alert('Error de red');
        }
      }

      async function deletePeleador(id) {
        if (!confirm('¿Seguro que desea eliminar este peleador?')) return;
        try {
          const res = await fetch(`/peleadores/${id}`, { method: 'DELETE' });
          const body = await res.json();
          if (body.success) {
            location.reload();
          } else {
            alert('No se pudo eliminar');
          }
        } catch (err) {
          console.error(err);
          alert('Error de red');
        }
      }
    </script>
  </body>
</html>